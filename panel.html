<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<title>Panel Admin</title>

<style>
body{
margin:0;
font-family:monospace;
}

.factura{
width:80mm;
max-width:80mm;
padding:10px;
font-size:12px;
}

.logo{
text-align:center;
margin-bottom:5px;
}

.logo img{
width:120px;
max-width:100%;
}

.encabezado{
text-align:center;
font-size:12px;
margin-bottom:8px;
}

textarea{
width:100%;
height:200px;
font-size:12px;
border:1px solid #ccc;
}

button{
width:100%;
margin-top:5px;
padding:8px;
}

@media print {

body *{
display:none;
}

.factura, .factura *{
display:block;
}

.factura{
position:absolute;
top:0;
left:0;
width:80mm;
}

textarea{
border:none;
resize:none;
}

button{
display:none;
}

}
</style>
</head>

<body>

<div class="sidebar">
<h3>Fechas</h3>
<div id="fechas"></div>
</div>

<div class="main">
<h2>Pedidos del dÃ­a</h2>
<div class="grid" id="grid"></div>
</div>

<div class="modal" id="modal">
<div class="factura">

<div class="logo">
<img src="TU_LOGO_AQUI.png">
</div>

<div class="encabezado">
<strong>PanaderÃ­a Andrey</strong><br>
NIT: 123456789<br>
Tel: 3000000000<br>
Barrio: San Telmo
</div>

<hr>

<h4 id="facturaCliente"></h4>

<textarea id="facturaTexto"></textarea>

<button onclick="imprimir()">ðŸ–¨ Imprimir</button>
<button onclick="guardarEdicion()">ðŸ’¾ Guardar cambios</button>
<button onclick="cerrar()">Cerrar</button>

</div>

// ðŸ”´ PEGA TU SUPABASE
const SUPABASE_URL="https://vswostjubcxjotpqnzhk.supabase.co";
const SUPABASE_ANON="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzd29zdGp1YmN4am90cHFuemhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyOTAyNDksImV4cCI6MjA4Nzg2NjI0OX0.VIWMJWyubtKj7QCoOybia_Fv2S4sjxFelQz9x1tZKBo";

const { createClient } = supabase;
const db=createClient(SUPABASE_URL,SUPABASE_ANON);

let pedidoActualId=null;


// CARGAR FECHAS
async function cargarFechas(){

let {data} = await db
.from("pedidos")
.select("fecha")
.order("fecha",{ascending:false});

let fechasUnicas=[...new Set(data.map(p=>p.fecha.split("T")[0]))];

let cont=document.getElementById("fechas");
cont.innerHTML="";

fechasUnicas.forEach(f=>{
cont.innerHTML+=`
<div class="fecha-btn" onclick="cargarPedidos('${f}')">
${f}
</div>`;
});

}


// CARGAR PEDIDOS POR DIA
async function cargarPedidos(fecha){

let {data}=await db
.from("pedidos")
.select("*")
.gte("fecha",fecha+"T00:00:00")
.lte("fecha",fecha+"T23:59:59");

let grid=document.getElementById("grid");
grid.innerHTML="";

data.forEach(p=>{
grid.innerHTML+=`
<div class="card" onclick="abrirFactura(${p.id},\`${p.pedido}\`,\`${p.cliente}\`)">
<h4>${p.cliente}</h4>
<p>$${p.total}</p>
</div>`;
});

}


// ABRIR FACTURA
function abrirFactura(id,texto,cliente){
pedidoActualId=id;
document.getElementById("modal").style.display="flex";
document.getElementById("facturaTexto").value=texto;
document.getElementById("facturaCliente").innerText=cliente;
}


// IMPRIMIR
function imprimir(){
window.print();
}


// GUARDAR CAMBIOS
async function guardarEdicion(){

let nuevoTexto=document.getElementById("facturaTexto").value;

await db.from("pedidos")
.update({pedido:nuevoTexto})
.eq("id",pedidoActualId);

alert("Factura actualizada âœ”");
}


// CERRAR
function cerrar(){
document.getElementById("modal").style.display="none";
}


cargarFechas();

</script>

</body>
</html>
