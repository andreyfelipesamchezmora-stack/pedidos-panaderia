<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<title>Panel Admin</title>

<style>
body{
margin:0;
font-family:Arial;
display:flex;
height:100vh;
}

/* SIDEBAR */
.sidebar{
width:220px;
background:#222;
color:white;
padding:15px;
overflow-y:auto;
}

.sidebar h3{
margin-top:0;
}

.fecha-btn{
background:#333;
padding:8px;
margin-bottom:8px;
cursor:pointer;
border-radius:6px;
}

/* PANEL */
.main{
flex:1;
padding:20px;
background:#f5f5f5;
overflow-y:auto;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
gap:15px;
}

.card{
background:white;
padding:15px;
border-radius:12px;
cursor:pointer;
box-shadow:0 3px 8px rgba(0,0,0,0.1);
}

.card h4{
margin:0 0 5px 0;
}

/* MODAL FACTURA */
.modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.5);
display:none;
align-items:center;
justify-content:center;
}

.factura{
background:white;
width:80mm;
padding:10px;
font-size:12px;
}

.factura textarea{
width:100%;
height:200px;
font-size:12px;
}

.factura button{
width:100%;
margin-top:5px;
padding:8px;
}

@media print{
body *{
visibility:hidden;
}
.factura, .factura *{
visibility:visible;
}
.factura{
position:absolute;
left:0;
top:0;
}
}
</style>
</head>

<body>

<div class="sidebar">
<h3>Fechas</h3>
<div id="fechas"></div>
</div>

<div class="main">
<h2>Pedidos del dÃ­a</h2>
<div class="grid" id="grid"></div>
</div>

<div class="modal" id="modal">
<div class="factura">
<h4 id="facturaCliente"></h4>
<textarea id="facturaTexto"></textarea>
<button onclick="imprimir()">ðŸ–¨ Imprimir</button>
<button onclick="guardarEdicion()">ðŸ’¾ Guardar cambios</button>
<button onclick="cerrar()">Cerrar</button>
</div>
</div>

<script>

// ðŸ”´ PEGA TU SUPABASE
const SUPABASE_URL="TU_URL";
const SUPABASE_ANON="TU_ANON";

const { createClient } = supabase;
const db=createClient(SUPABASE_URL,SUPABASE_ANON);

let pedidoActualId=null;


// CARGAR FECHAS
async function cargarFechas(){

let {data} = await db
.from("pedidos")
.select("fecha")
.order("fecha",{ascending:false});

let fechasUnicas=[...new Set(data.map(p=>p.fecha.split("T")[0]))];

let cont=document.getElementById("fechas");
cont.innerHTML="";

fechasUnicas.forEach(f=>{
cont.innerHTML+=`
<div class="fecha-btn" onclick="cargarPedidos('${f}')">
${f}
</div>`;
});

}


// CARGAR PEDIDOS POR DIA
async function cargarPedidos(fecha){

let {data}=await db
.from("pedidos")
.select("*")
.gte("fecha",fecha+"T00:00:00")
.lte("fecha",fecha+"T23:59:59");

let grid=document.getElementById("grid");
grid.innerHTML="";

data.forEach(p=>{
grid.innerHTML+=`
<div class="card" onclick="abrirFactura(${p.id},\`${p.pedido}\`,\`${p.cliente}\`)">
<h4>${p.cliente}</h4>
<p>$${p.total}</p>
</div>`;
});

}


// ABRIR FACTURA
function abrirFactura(id,texto,cliente){
pedidoActualId=id;
document.getElementById("modal").style.display="flex";
document.getElementById("facturaTexto").value=texto;
document.getElementById("facturaCliente").innerText=cliente;
}


// IMPRIMIR
function imprimir(){
window.print();
}


// GUARDAR CAMBIOS
async function guardarEdicion(){

let nuevoTexto=document.getElementById("facturaTexto").value;

await db.from("pedidos")
.update({pedido:nuevoTexto})
.eq("id",pedidoActualId);

alert("Factura actualizada âœ”");
}


// CERRAR
function cerrar(){
document.getElementById("modal").style.display="none";
}


cargarFechas();

</script>

</body>
</html>
